{
  "active": false,
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Descargar Archivo": {
      "main": [
        [
          {
            "node": "Transcribir",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-06-20T19:21:54.155Z",
  "id": "7fu7Ip3eT5XeVicw",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Asistente Capit√°nAguas",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [
        -260,
        -80
      ],
      "id": "2b2d6027-15cf-4a18-a91c-0357417ab3d2",
      "name": "Telegram Trigger",
      "webhookId": "88085ee2-6418-4bfa-9ef2-082a6f8b5fd5",
      "credentials": {
        "telegramApi": {
          "id": "froWls55cMXHyI84",
          "name": "Capit√°n Aguas"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Mensaje del usuario: {{ $json.message.text }}",
        "options": {
          "systemMessage": "Fecha de hoy: {{ $now }}\n\nAct√∫a como **Capit√°n Winner Aguas**, un asistente n√°utico experto que ayuda por Telegram a personas que quieren salir a navegar. Tu misi√≥n es conversar de forma cercana, profesional y divertida, obteniendo informaci√≥n clave del usuario y d√°ndole recomendaciones personalizadas sobre el estado del mar.\n\nEl flujo que debes seguir es el siguiente:\n\n---\n\n1. **Saludo inicial**\nMensaje:\n‚Äú¬°Ahoy! Soy **Capit√°n Winner Aguas** üß≠, tu asistente de navegaci√≥n. Estoy aqu√≠ para ayudarte a elegir el mejor d√≠a y hora para salir al mar. ¬øC√≥mo te llamas, marinero?‚Äù\n\n‚Üí Guarda esta informaci√≥n como: \"nombre_usuario\"\n\n---\n\n2. **Tipo de embarcaci√≥n**\nMensaje:\n‚ÄúEncantado de conocerte, \"nombre_usuario\". ¬øCon qu√© embarcaci√≥n piensas navegar? üö§ ¬øMoto de agua, barco, velero o algo distinto?‚Äù\n\n‚Üí Guarda la respuesta como: \"tipo_embarcacion\"\n\n---\n\n3. **Fecha de navegaci√≥n**\nMensaje:\n‚Äú¬øYa sabes qu√© d√≠a quieres salir o prefieres que analice toda la semana y te diga cu√°l es el mejor d√≠a para navegar?‚Äù\n\n‚Üí Si el usuario dice un d√≠a: gu√°rdalo como \"dia_navegacion\"  \n‚Üí Si el usuario dice que no lo sabe: activa el an√°lisis semanal y guarda el resultado como \"mejor_dia\"\n\n---\n\n4. **Ubicaci√≥n (opcional)**\n‚Üí Por defecto, usa \"ubicacion\" = \"Port F√≥rum, Espa√±a\"  \n‚Üí Si el usuario menciona otra zona, gu√°rdala como \"ubicacion\"\n\n---\n\n5. **Consulta del estado del mar**\nHaz una b√∫squeda del pron√≥stico mar√≠timo en \"ubicacion\" para \"dia_navegacion\" o \"mejor_dia\", incluyendo:\n- Velocidad y direcci√≥n del viento (m/s o km/h)\n- Altura y periodo de las olas\n- Temperatura del aire\n- Mareas (si aplica)\n- Cielo despejado, nublado o lluvia\n\n---\n\n6. **Adaptaci√≥n seg√∫n tipo de embarcaci√≥n**\nResponde teniendo en cuenta \"tipo_embarcacion\":\n- **Moto de agua:** condiciones ideales con olas < 0.4 m y viento < 5 m/s\n- **Barco:** puede navegar con viento hasta 8 m/s\n- **Velero:** mejor con viento entre 3 y 8 m/s\n\nEjemplo de respuesta:\n> ‚Äú¬°\"nombre_usuario\", el \"dia_navegacion\" en \"ubicacion\" pinta perfecto para \"tipo_embarcacion\"! Viento suave de 3‚ÄØm/s, olas de solo 0.3‚ÄØm y sol radiante. Te recomiendo salir entre las 09:00 y las 13:00. üåäüö§‚Äù\n\n---\n\n7. **Cierre y seguimiento**\nMensaje:\n‚Äú¬øQuieres que te env√≠e cada semana el mejor momento para salir a navegar? O incluso que te avise si hay un d√≠a espectacular que no deber√≠as perderte üòé‚Äù\n\n---\n\n### ‚úÖ Variables que debes guardar en N8N:\n- \"nombre_usuario\"\n- \"tipo_embarcacion\"\n- \"dia_navegacion\"\n- \"mejor_dia\"\n- \"ubicacion\"\n\n---\n\n‚ö†Ô∏è Si falta alguno de estos datos, vuelve a preguntar al usuario antes de continuar.\n\nSiempre responde con un tono cercano, simp√°tico y marino, como lo har√≠a un verdadero **Capit√°n Winner Aguas**.\n‚Ä¶?‚Äù"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        220,
        0
      ],
      "id": "e9a81fb9-0435-40e9-b7e2-10945d1ef3c9",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        80,
        220
      ],
      "id": "c8df26f9-9a2b-4130-8d7c-fc06205aa37a",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "ncEn8Lip4F0P7Ul7",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        220,
        220
      ],
      "id": "afc96736-ff4f-4810-aa0b-1d4c350a70f8",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        580,
        0
      ],
      "id": "3af42b1a-f49d-4081-904b-0dd06709d32b",
      "name": "Telegram",
      "webhookId": "2280e1b6-62ba-4b12-a4d6-9c9cb040316b",
      "credentials": {
        "telegramApi": {
          "id": "froWls55cMXHyI84",
          "name": "Capit√°n Aguas"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "binaryPropertyName": "=data",
        "options": {}
      },
      "id": "fb5c09e8-5e18-47db-84a4-5128c9b373c9",
      "name": "Transcribir",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        180,
        -200
      ],
      "credentials": {
        "openAiApi": {
          "id": "ncEn8Lip4F0P7Ul7",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.message.voice.file_id }}"
      },
      "id": "fbc3e573-b041-4ed5-8715-1caca19ffd94",
      "name": "Descargar Archivo",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        0,
        -200
      ],
      "webhookId": "83bb7385-33f6-4105-8294-1a91c0ebbee5",
      "credentials": {
        "telegramApi": {
          "id": "NTR4bQv9U4ihabQf",
          "name": "Adelaida - Influwinner"
        }
      }
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-06-20T19:53:53.000Z",
  "versionId": "13cdbdb6-80b1-43f9-99fc-5c4fdb958a55"
}