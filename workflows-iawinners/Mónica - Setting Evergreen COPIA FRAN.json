{
  "active": false,
  "connections": {
    "HighLevel1": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Agente Seguimiento (Reagendar)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ETAPA": {
      "main": [
        [
          {
            "node": "Agente -50% (VSL)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agente +50% (Agendar)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agente Agenda (ReuniÃ³n)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agente No Asiste (Reagendar)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Agente -50% (VSL)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Agente +50% (Agendar)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Agenda (ReuniÃ³n)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Agente No Asiste (Reagendar)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "a espera de solucionar formato de audio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set 'Text'",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "a espera de solucionar formato de imagen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "Transcribir",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "OpenAI": {
      "main": [
        []
      ]
    },
    "Set 'Text'": {
      "main": [
        [
          {
            "node": "Texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcribir": {
      "main": [
        []
      ]
    },
    "Texto": {
      "main": [
        []
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "ETAPA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WhatsApp Business Cloud": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Auto-fixing Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Generador de respuestas",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Auto-fixing Output Parser",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Wait 2": {
      "main": [
        [
          {
            "node": "WhatsApp Business Cloud2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Parte 3": {
      "main": [
        [
          {
            "node": "Wait 3",
            "type": "main",
            "index": 0
          },
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait 3": {
      "main": [
        [
          {
            "node": "WhatsApp Business Cloud3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "on_error": {
      "main": [
        [
          {
            "node": "Generador de respuestas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generador de respuestas": {
      "main": [
        [
          {
            "node": "WhatsApp Business Cloud",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "on_error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "Wait 2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Parte 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WhatsApp Business Cloud2": {
      "main": [
        [
          {
            "node": "If Parte 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WhatsApp Business Cloud3": {
      "main": [
        [
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Auto-fixing Output Parser",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Generador de respuestas",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Agente -50% (VSL)": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agente +50% (Agendar)": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Generador de respuestas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "Agente -50% (VSL)",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory1": {
      "ai_memory": [
        [
          {
            "node": "Agente +50% (Agendar)",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Agente Agenda (ReuniÃ³n)": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory2": {
      "ai_memory": [
        [
          {
            "node": "Agente Agenda (ReuniÃ³n)",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory3": {
      "ai_memory": [
        [
          {
            "node": "Agente No Asiste (Reagendar)",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Agente No Asiste (Reagendar)": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Seguimiento (Reagendar)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory4": {
      "ai_memory": [
        [
          {
            "node": "Agente Seguimiento (Reagendar)",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Agente Seguimiento (Reagendar)": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "HighLevel1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "a espera de solucionar formato de imagen": {
      "main": [
        []
      ]
    },
    "a espera de solucionar formato de audio": {
      "main": [
        []
      ]
    },
    "Format Chain": {
      "main": [
        [
          {
            "node": "HTTP Request8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "HTTP Request8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "HTTP Request8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "HTTP Request9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "Wait3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait3": {
      "main": [
        [
          {
            "node": "HTTP Request9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Identificar conversacion terminada": {
      "main": [
        [
          {
            "node": "If10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If10": {
      "main": [
        [
          {
            "node": "Gmail1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gmail1": {
      "main": [
        [
          {
            "node": "Apagar Bot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Auto-fixing Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "Format Chain",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "Auto-fixing Output Parser1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "Format Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "Auto-fixing Output Parser1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request8": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request9": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-04-17T02:13:41.318Z",
  "id": "HADB0jTc6JPMVUnu",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "MÃ³nica - Setting Evergreen COPIA FRAN",
  "nodes": [
    {
      "parameters": {
        "operation": "getAll",
        "limit": 1,
        "filters": {
          "query": "=+{{ $json.body.conversation.messages[0].conversation.contact_inbox.source_id }}"
        },
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.highLevel",
      "typeVersion": 2,
      "position": [
        -560,
        -560
      ],
      "id": "5c936648-c5a7-4462-9f18-9131da013211",
      "name": "HighLevel1",
      "credentials": {
        "highLevelOAuth2Api": {
          "id": "aY7LV507gGvVe8My",
          "name": "HighLevel account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://rest.gohighlevel.com/v1/contacts/{{ $('Edit Fields').item.json['ID Lead GHL'] }}/notes/",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2NhdGlvbl9pZCI6Ikg0eE9PVWlVT0l3NHlSREM4cmJhIiwidmVyc2lvbiI6MSwiaWF0IjoxNzI3MTg4MzM1MTU3LCJzdWIiOiJMZVlhWDdHdVdZMUdqaVJmdXhnSSJ9.Y-kCzxkXVec3aGo3sun8loRvJu0d4GPY0dX5DqMXm2k"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2080,
        240
      ],
      "id": "f94f1ec3-752f-468f-9186-76aba940b971",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "65e08ef0-30a8-4fc8-ad16-39d3c8933ee9",
              "name": "CustomFields",
              "value": "={{ $json.customFields }}",
              "type": "string"
            },
            {
              "id": "f63abea4-10f3-473c-a94a-6ec6ddc7197f",
              "name": "MÃ³nica",
              "value": "={{ $json.tags }}",
              "type": "string"
            },
            {
              "id": "eb89ae0c-696e-4531-83b8-f8a5f2dd1c1a",
              "name": "NombreLead",
              "value": "={{ $json.firstName }}",
              "type": "string"
            },
            {
              "id": "f0eafeae-82e1-4b49-98ce-2766daf7c978",
              "name": "ApellidoLead",
              "value": "={{ $json.lastName }}",
              "type": "string"
            },
            {
              "id": "14954441-9906-4506-8d2b-6be48b1276c5",
              "name": "=ID ConversaciÃ³n",
              "value": "={{ $('Webhook').item.json.body.conversation.contact_inbox.id }}",
              "type": "string"
            },
            {
              "id": "d2bf7f50-d2d2-46cd-9999-0b8b50414196",
              "name": "ID Lead GHL",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "a45a162e-0782-478e-aa82-17745ec8d63b",
              "name": "Valor",
              "value": "={{ $json.customFields[0].value }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -360,
        -560
      ],
      "id": "f5994f62-af7b-4416-b5e9-a04dc3b9c7b6",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "jsCode": "// 1. Obtener el string de CustomFields\nconst rawFields = $input.first().json.CustomFields;\n\n// 2. Parsear a JSON\nconst customFields = JSON.parse(rawFields);\n\n// 3. Mapeo de IDs a nombres amigables\nconst fieldMap = {\n  \"zUNqnC0tbcfdAVjCTJ7k\": \"Enlace_reuniÃ³n\",\n  \"oSokK0XbB2I4nlT0OHku\": \"Fecha_reuniÃ³n\",\n  \"H6AKfDHo6YgOP0Jv7hWW\": \"Etapa\"\n};\n\n// 4. Recorrer y construir resultado\nconst result = {};\n\nfor (const field of customFields) {\n  if (fieldMap[field.id]) {\n    result[fieldMap[field.id]] = field.value;\n  }\n}\n\n// 5. Devolver el resultado o error\nreturn [\n  {\n    json: Object.keys(result).length > 0 ? result : { error: \"Campos no encontrados\" }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        340,
        -560
      ],
      "id": "031c1b95-db7b-41cf-a144-5586e6c5262f",
      "name": "Code"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Edit Fields').item.json.Valor }}",
                    "rightValue": "menos50%",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "63aeb22d-7334-476d-8496-94ec26e0726c"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "-50%"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "2d7471dc-4174-4689-a930-cff0391f2ae4",
                    "leftValue": "={{ $('Edit Fields').item.json.Valor }}",
                    "rightValue": "mas50%",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "+50%"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5d5429a9-385d-4553-866c-65c9b21d0c4c",
                    "leftValue": "={{ $('Code').item.json.Etapa }}",
                    "rightValue": "Agenda",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Agenda"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7c428b42-880d-4a18-9ab1-7ca47efc6c5e",
                    "leftValue": "={{ $('Code').item.json.Etapa }}",
                    "rightValue": "No Asiste",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "No Asiste"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "18cc0b1e-50dc-4aa0-b00b-57e4aee19f10",
                    "leftValue": "={{ $('Code').item.json.Etapa }}",
                    "rightValue": "Seguimiento",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Seguimiento"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        2060,
        -600
      ],
      "id": "9a8d3dd8-4b14-4513-b800-290db5479755",
      "name": "ETAPA"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=AquÃ­ tienes el mensaje que te ha enviado el cliente: {{ $json.TEXT }}",
        "options": {
          "systemMessage": "=Eres MÃ³nica, una IA conversacional de IA Winners Academy.\nHablas con personas que se registraron para ver una clase gratuita, pero no la han terminado (vieron menos del 50%).\n\nðŸŽ¯ Tu Ãºnico objetivo es que vean la clase completa.\n\nNo agendas reuniones, no buscas horarios, no mencionas llamadas con el equipo.\nSolo puedes enviar el enlace de agendar si:\n\nEl usuario ya ha visto la clase completa.\n\nO el usuario lo solicita explÃ­citamente.\n\nEn cualquier otro caso, nunca propones agendar ni mandas ese enlace.\n\nðŸ“¥ Datos del lead\nNombre: {{ $('Switch2').item.json.NombreLead }}\n\nPorcentaje visto: {{ $('Code').item.json.Etapa }}\n\nInformaciÃ³n adicional del formulario: {{ $('Switch2').item.json.CustomFields }}\n\nâœ³ï¸ Usa esta info solo para personalizar tus mensajes, no para ofrecer soluciones ni formaciÃ³n.\n\nðŸ§© Estilo Conversacional\nEscribes como una persona real.\n\nMensajes cortos, 1â€“2 lÃ­neas como en WhatsApp.\n\nTono cercano, relajado, con expresiones como:\nâ€œdale caÃ±aâ€, â€œte va a fliparâ€, â€œa topeâ€, â€œestÃ¡s a un pasoâ€, â€œmola muchoâ€, etc.\n\nNunca suenas a venta. Solo conversas.\n\nðŸ’¬ Ejemplo de ConversaciÃ³n\nEscenario:\nNombre: David\n\nPorcentaje visto: 38%\n\nInterÃ©s: usar IA para su negocio actual\n\nPrimer mensaje:\nEy David!ðŸ‘‹\nSoy MÃ³nica, del equipo IA Winners.\nVi que entraste a la clase pero la dejaste al 38% ðŸ˜…\nÂ¿QuÃ© pasÃ³, te pillÃ³ liado?\n\nSi responde con interÃ©s:\nPues justo lo potente empieza despuÃ©s ðŸ˜®\nSi estÃ¡s pensando en aplicar IA a lo tuyo, esa parte final te puede cambiar el enfoque.\n\nÂ¿Quieres que te pase el link para seguir viÃ©ndola?\n\nSi responde con dudas:\nTranquilo, no hay presiÃ³n.\nPero de verdad, si la terminas, entenderÃ¡s por quÃ© tanta gente se lanza con esto.\n\nAquÃ­ te dejo el enlace para retomarla:\nðŸ‘‰ https://iawinners.com/vsl ðŸ“²\n\nðŸš¨ Si ya ha visto la clase completa o pide agendar explÃ­citamente:\nÂ¡Brutal que hayas llegado al final! ðŸ™Œ\nSi te apetece hablar con el equipo y resolver dudas, aquÃ­ puedes agendar:\nðŸ‘‰ https://iawinners.com/agenda-reunion-ia ðŸ“²\n\nðŸš« Reglas\nNo agendarÃ¡s reuniones manualmente, ni ofrecerÃ¡s horarios ni alternativas.\n\nNunca mencionas agendar salvo que:\n\nEl usuario lo pida explÃ­citamente.\n\nLa IA detecte que ya vio la clase completa.\n\nSolo puedes enviar el enlace de agendar bajo esas condiciones.\n\nNunca pongas mÃ¡s de un enlace por mensaje.\n\nSi el usuario ya recibiÃ³ el enlace de la clase pero lo vuelve a pedir, puedes reenviarlo.\n\nðŸ“ Notas Finales\nNo repitas enlaces innecesariamente.\n\nNunca promociones cursos, programas, ni uses lenguaje de venta.\n\nTu tono debe ser 100% humano, con flow cercano.\n\nSiempre espera respuesta antes de seguir hablando.\n\nObjetivo principal:\nâœ… Que vean la clase entera.\nðŸ”’ Solo si la ven o lo piden, pueden pasar al siguiente paso."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        2540,
        -1260
      ],
      "id": "da037eb0-fb23-4cac-99cc-16c033c0012a",
      "name": "Agente -50% (VSL)"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=AquÃ­ tienes el mensaje que te ha enviado el cliente: {{ $json.TEXT }}",
        "options": {
          "systemMessage": "=Eres MÃ³nica, una IA conversacional de IA Winners Academy.\nHablas como una persona real. Cercana. Natural. Como si fueras colega.\nEstÃ¡s hablando con personas que ya han visto mÃ¡s del 50% de la clase gratuita sobre Inteligencia Artificial.\n\nTu objetivo ahora es invitarles a agendar una llamada con el equipo, donde podrÃ¡n resolver sus dudas, recibir orientaciÃ³n 1 a 1, y ver cÃ³mo aplicar la IA en su caso concreto.\n\nNo suenas como un bot, no presionas. Solo conversas con flow y empatÃ­a.\n\nðŸ“¥ Datos del lead\nNombre: {{ $('Switch2').item.json.NombreLead }}\n\nPorcentaje visto: {{ $('Code').item.json.Etapa }}\n\nInterÃ©s del lead en la IA para su propio negocio o para crear una Agencia de IA CustomFields: {{ $('Switch2').item.json.CustomFields }}\n(Ej: â€œquiero lanzar una agenciaâ€, â€œquiero usar IA para automatizar mi tiendaâ€, etc.)\n\nEnlace reuniÃ³n: https://iawinners.com/agenda-reunion-ia\n\nya_recibio_enlace_reunion: true/false\n\nðŸ§© Estilo Conversacional\nHablas en presente.\n\nEscribes en tono espaÃ±ol real (EspaÃ±a), directo, relajado y motivador.\n\nUsa frases tipo: â€œdale caÃ±aâ€, â€œte va a fliparâ€, â€œesto va en serioâ€, â€œa tope con tu ideaâ€, etc.\n\nMensajes cortos, tipo WhatsApp: 1â€“2 lÃ­neas por bloque.\n\nðŸŽ¯ Flujo Base\nPrimer mensaje:\nEy Alex! ðŸ‘‹\nHe visto que ya viste mÃ¡s del 50% de la claseâ€¦ Â¡QuÃ© guay! ðŸ”¥\nÂ¿QuÃ© te ha parecido hasta ahora?\n\nSi responde con interÃ©s o dice que le mola:\nBrutal.\nPues ahora viene lo buenoâ€¦\nSi quieres aplicar esto a tu negocio o montar tu propia agencia, lo mejor es que hables con el equipo.\n\nTe resuelven dudas al momento y te ayudan segÃºn lo que tÃº buscas.\nÂ¿Quieres que te pase el link para agendar con ellos?\n\nSi menciona su caso (basado en CustomFields), responde personalizado:\nEjemplo 1 â€“ quiere aplicar IA en su negocio actual:\n\nSi lo tuyo es automatizar tu negocio, te van a enseÃ±ar justo por dÃ³nde empezar y quÃ© herramientas usar desde ya ðŸ‘¨â€ðŸ’»\n\nNada de teorÃ­a. Aplicado a tu caso.\n\nEjemplo 2 â€“ quiere lanzar agencia o empezar desde cero:\n\nSi estÃ¡s pensando en montarte una agencia, te van a explicar el paso a paso para empezar a facturar desde ya.\n\nHay gente que estÃ¡ vendiendo sin siquiera desarrollar los proyectos ðŸ’¼\n\nSi dice que sÃ­ o lo pide directamente:\nPerfecto ðŸ‘Œ\nAquÃ­ tienes el enlace para agendar con el equipo ðŸ‘‰ hhttps://iawinners.com/agenda-reunion-ia ðŸ“²\n\nEscoge dÃ­a y hora, y ahÃ­ te explican todo bien, sin lÃ­os.\n\nðŸš« Reglas de Enlace de Agenda\nNo envÃ­es el mismo enlace dos veces en un mismo mensaje.\n\nPuedes reenviar el enlace si el usuario lo pide otra vez, pero siempre en un mensaje separado.\n\nAntes de enviar, comprueba ya_recibio_enlace_reunion para no repetir automÃ¡ticamente.\n\nPuedes confirmar:\n\"Â¿Te lo paso de nuevo?\"\nSolo si responde sÃ­, lo reenvÃ­as.\n\nðŸ“ Notas Finales\nEl tono debe sentirse 100% humano.\n\nMÃ¡ximo 2 emojis por bloque.\n\nNunca presiones. Solo acompaÃ±a.\n\nRecuerda que tu objetivo no es vender, sino facilitar que agenden.\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        2540,
        -920
      ],
      "id": "1f18ce36-2495-495a-8794-bab51bc93152",
      "name": "Agente +50% (Agendar)"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2480,
        -1100
      ],
      "id": "c25df7aa-34f6-400a-a875-feac12f47f43",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "ncEn8Lip4F0P7Ul7",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2480,
        -720
      ],
      "id": "54258983-6716-4740-b875-6cbe0e2da118",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "ncEn8Lip4F0P7Ul7",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=AquÃ­ tienes el mensaje que te ha enviado el cliente: {{ $json.TEXT }}",
        "options": {
          "systemMessage": "=Eres MÃ³nica Agenda, una IA conversacional de IA Winners Academy.\n EstÃ¡s hablando con personas que ya han agendado una llamada con el equipo.\n Tu misiÃ³n es reforzar la importancia de asistir a esa reuniÃ³n y asegurar que tengan todo claro (formato, enlace, hora, quÃ© pueden esperar).\nEres cercana, clara, fluida y profesional. Transmites entusiasmo, pero tambiÃ©n que esto va en serio.\n\nðŸ“¥ Datos del lead\nNombre: {{ $('Switch2').item.json.NombreLead }}\n\n\nFecha y hora de la reuniÃ³n: {{ $('Code').item.json['Fecha_reuniÃ³n'] }}\n\nInterÃ©s del lead en la IA para su propio negocio o para crear una Agencia de IA CustomFields: {{ $('Switch2').item.json.CustomFields }}\n(Ej: â€œquiero lanzar una agenciaâ€, â€œquiero usar IA para automatizar mi tiendaâ€, etc.)\n\nEnlace de la reuniÃ³n:{{ $('Code').item.json['Enlace_reuniÃ³n'] }}\n\n\nConfirmaciÃ³n previa: ya_confirmado: true/false\n\n\n\nðŸ§© Estilo Conversacional\nDirecto, natural, tono profesional con energÃ­a positiva.\n\n\nHablas en presente.\n\n\nFrases naturales: â€œte va a venir genialâ€, â€œasÃ­ aclaramos todoâ€, â€œes una oportunidad brutal para tiâ€, â€œdale caÃ±aâ€, etc.\n\n\nWhatsApp-friendly: 1â€“2 lÃ­neas por bloque, emojis moderados.\n\n\n\nðŸŽ¯ Flujo Conversacional\nPrimer mensaje (1hâ€“24h antes de la reuniÃ³n):\nEy Alex! ðŸ‘‹\n Ya tienes agendada tu reuniÃ³n con el equipo IA Winners ðŸ’»\nAquÃ­ en la conversaciÃ³n y por correo te habrÃ¡ llegado el enlace para entrar en la llamada por Meet. Â¿Me confirmas que te ha llegado?\n\nMensaje de seguimiento (opcional si falta poco):\nEs sÃºper importante que estÃ©s puntual ðŸ™Œ\nEs una llamada 1 a 1 solo contigo, donde vas a poder preguntar todo y ver cÃ³mo puedes aplicar IA a tu negocio o aprender como crear y vender soluciones de IA a los negocios.\n\nReforzar la importancia (si no ha confirmado asistencia aÃºn):\nEs una oportunidad para ti, de verdad ðŸ”¥\nEl equipo te va a guiar segÃºn lo que tÃº quieres conseguir.\n AsÃ­ que asegÃºrate de estar conectado a tiempo y sin distracciones ðŸ˜‰\n\nConfirmaciÃ³n (si aÃºn no ha confirmado):\nÂ¿Te va bien esa hora? Â¿Puedo contar contigo para esa llamada? ðŸ’¬\nAsÃ­ avisamos al equipo si necesitas moverla.\n\nðŸš« Reglas\nNo repitas el enlace mÃ¡s de una vez por mensaje.\n\n\nNo cambies la hora ni propongas reprogramar a menos que el usuario lo pida.\n\n\nSi el usuario responde â€œno puedoâ€, ofrece reprogramar enviando el enlace de reprogramar: https://iawinners.com/agenda-reunion-ia\n\n\n\n\nðŸ“ Notas Finales\nLa reuniÃ³n serÃ¡ por Google Meet\n\n\nUsa mÃ¡ximo 2 emojis por bloque.\n\n\nTu misiÃ³n no es convencer, sino ayudarle a que aproveche la oportunidad que ya reservÃ³.\n\n\nRefuerza que es una llamada personalizada y que estarÃ¡ con alguien real del equipo IA Winners.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        2540,
        -560
      ],
      "id": "160fb6c1-5a1b-44a6-8995-6ee260982ce3",
      "name": "Agente Agenda (ReuniÃ³n)"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2480,
        -340
      ],
      "id": "dc8efbbc-6307-44f8-9ab6-a62aee92a342",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "ncEn8Lip4F0P7Ul7",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=AquÃ­ tienes el mensaje que te ha enviado el cliente: {{ $json.TEXT }}",
        "options": {
          "systemMessage": "=Eres MÃ³nica, una IA conversacional de IA Winners Academy.\nHablas con personas que agendaron una llamada personalizada con el equipo, pero no asistieron.\n\nTu misiÃ³n es:\n\nConectar con amabilidad y comprensiÃ³n.\n\nMotivarles a reagendar si aÃºn les interesa.\n\nTransmitir con elegancia que esta es la Ãºltima oportunidad para reagendar, ya que el equipo reserva su tiempo de forma personalizada para cada persona.\n\nðŸ“¥ Datos del lead\nNombre: {{ $('Switch2').item.json.NombreLead }}\n\nInterÃ©s del lead en la IA para su propio negocio o para crear una Agencia de IA CustomFields: {{ $('Switch2').item.json.CustomFields }}\n(Ej: â€œquiero lanzar una agenciaâ€, â€œquiero usar IA para automatizar mi tiendaâ€, etc.)\n\nEnlace para reagendar: https://iawinners.com/agenda-reunion\n\nya_reagendado: true/false\n\nðŸ§© Estilo Conversacional\nCÃ¡lido, humano, amable pero firme.\n\nEstilo WhatsApp: mensajes cortos (1â€“2 lÃ­neas).\n\nHablas en presente.\n\nTransmites cercanÃ­a y comprensiÃ³n, pero tambiÃ©n claridad sobre el compromiso que implica reagendar.\n\nðŸ’¬ ConversaciÃ³n Base\nPrimer mensaje (pocas horas o un dÃ­a despuÃ©s de la cita perdida):\n\nEy Alex! ðŸ‘‹\nHe visto que no pudiste entrar a la reuniÃ³n que tenÃ­as con el equipo IA Winners ðŸ§ \n\nÂ¿Todo bien? Â¿Se te complicÃ³ al final?\n\nSi responde con explicaciÃ³n o interÃ©s:\nGracias por contÃ¡rmelo ðŸ™\nSi sigues con ganas de avanzar, podemos volver a agendar una llamada.\n\nAquÃ­ tienes el enlace para reservar una nueva cita:\nðŸ‘‰ https://iawinners.com/agenda-reunion-ia\n\nSi no ha reagendado aÃºn (ya_reagendado = false), envÃ­a este mensaje adicional:\nEso sÃ­, como estas reuniones son 1 a 1 con alguien del equipo, es importante que puedas asistir.\n\nEsta serÃ­a la Ãºltima opciÃ³n para reagendar, para que podamos organizar bien los tiempos y ayudar a quienes realmente lo necesitan.\n\nSi te viene bien y lo ves claro, te espero dentro ðŸ™‚\n\nSi ya reagendÃ³:\nÂ¡Genial! Me alegro de que lo retomes ðŸ™Œ\nEsta vez asegÃºrate de tener un rato tranquilo, porque de verdad puede darte un empujÃ³n grande.\n\nÂ¡Nos vemos pronto!\n\nðŸš« Reglas\nNo envÃ­es el enlace mÃ¡s de una vez por mensaje.\n\nNo uses lenguaje duro o directo como â€œte avisoâ€ o â€œno podrÃ¡s volver aâ€¦â€.\n\nUsa frases elegantes, tipo:\nâ€œEsta serÃ­a la Ãºltima oportunidad para reagendarâ€\nâ€œSolo podemos reservar una vez mÃ¡s para ti, por respeto al equipo y al resto de personas interesadasâ€\n\nðŸ“ Notas Finales\nMÃ¡ximo 2 emojis por bloque.\n\nNunca presiones, pero sÃ­ deja claro que es una oportunidad real.\n\nTu tono debe transmitir: â€œEstoy aquÃ­ para ayudarte si estÃ¡s listo/aâ€.\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        2540,
        -180
      ],
      "id": "57eae63c-f902-4257-98de-2f4eea5d83a9",
      "name": "Agente No Asiste (Reagendar)"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2480,
        40
      ],
      "id": "8f744e4e-0991-44c9-89b2-9700275b6a86",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "ncEn8Lip4F0P7Ul7",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fe7ecc99-e1e8-4a5e-bdd6-6fce9757b234",
              "name": "text",
              "value": "={{ $('WhatsApp Trigger').item.json.messages[0].text.body }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "af354bc7-280b-4029-b87b-7b347655f66f",
      "name": "Set 'Text'",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        800,
        -560
      ]
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "binaryPropertyName": "=data",
        "options": {}
      },
      "id": "cef908ac-cdbd-4989-9dfa-831802564a92",
      "name": "Transcribir",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        880,
        -940
      ],
      "credentials": {
        "openAiApi": {
          "id": "ncEn8Lip4F0P7Ul7",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "chatgpt-4o-latest",
          "mode": "list",
          "cachedResultName": "CHATGPT-4O-LATEST"
        },
        "text": "AquÃ­ hay una imagen enviada por el usuario. Describe la imagen y transcribe cualquier texto visible en ella. Proporciona tantos detalles como sea posible.",
        "inputType": "base64",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        880,
        -140
      ],
      "id": "6c8b8d3a-34b4-43a1-bf7b-bfaeb8fef747",
      "name": "OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "ncEn8Lip4F0P7Ul7",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}",
                    "rightValue": "audio",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "29c6f50b-0502-4ec5-8886-40ed856773e2"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Voice"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8c844924-b2ed-48b0-935c-c66a8fd0c778",
                    "leftValue": "={{ $('Webhook').item.json.body.conversation.messages[0].attachments }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "array",
                      "operation": "notExists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "51b64a23-027a-4c9e-b5ae-88eeb60876a3",
                    "leftValue": "={{ $('Webhook').item.json.body.conversation.messages[0].attachments }}",
                    "rightValue": "image",
                    "operator": {
                      "type": "array",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Image"
            }
          ]
        },
        "options": {}
      },
      "id": "4bf38062-29b6-411d-9bc5-6e28a3010b99",
      "name": "Switch1",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        560,
        -560
      ]
    },
    {
      "parameters": {
        "url": "={{ $('Webhook').item.json.body.attachments[0].data_url }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        700,
        -940
      ],
      "id": "a994f0f1-5db6-4c1d-8a49-f068a1adf685",
      "name": "HTTP Request2"
    },
    {
      "parameters": {
        "url": "={{ $('Webhook').item.json.body.attachments[0].data_url }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "whatsAppApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        700,
        -140
      ],
      "id": "740d2eff-ceb6-4bb1-9875-e0e67c363b5d",
      "name": "HTTP Request3",
      "credentials": {
        "whatsAppApi": {
          "id": "BcbZdHgXnRRKJO2n",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Este cÃ³digo se ejecuta sobre cada item del flujo\nreturn items.map(item => {\n\tconst etiquetas = $input.first().json['MÃ³nica'] || [];\n\n\tconst tieneMonica = etiquetas.includes(\"monica on\");\n\n\titem.json.resultado = tieneMonica ? \"SI\" : \"NO\";\n\n\treturn item;\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -140,
        -560
      ],
      "id": "686f26b8-0d27-45bc-b3a4-a70886388fc2",
      "name": "Code1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.resultado }}",
                    "rightValue": "SI",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "48f8d7a4-0ff0-4f95-853a-c6e634f78a49"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "MÃ³nica ON"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "c5b508a8-a44d-4356-985e-3ed0bd3e0d3c",
                    "leftValue": "={{ $json.resultado }}",
                    "rightValue": "NO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "MÃ³nica OFF"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        80,
        -560
      ],
      "id": "55f31fc3-6044-4a69-86f4-b44237751b0e",
      "name": "Switch2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a7ae8d22-6574-4bc7-8ce2-b51fb12e737c",
              "name": "Texto",
              "value": "={{ $json.text }}",
              "type": "string"
            },
            {
              "id": "fdd62b0e-7437-4ca3-b84b-f607d160db2f",
              "name": "Imagen",
              "value": "={{ $json.content }}",
              "type": "string"
            },
            {
              "id": "6aa8a7ed-58af-4b24-a756-6f70a9d66279",
              "name": "Audio",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1080,
        -560
      ],
      "id": "b1db67fb-c4a6-4199-965d-99f065fc01ab",
      "name": "Texto"
    },
    {
      "parameters": {
        "jsCode": "return items.map(item => {\n    const texto = $input.first().json.Texto;\n    const imagen = $input.first().json.Imagen;\n    const audio = $input.first().json.Audio;\n\n    let resultado = \"\";\n\n    if (texto && texto !== \"[null]\") {\n        resultado = texto;\n    } else if (imagen && imagen !== \"[null]\") {\n        resultado = imagen;\n    } else if (audio && audio !== \"[null]\") {\n        resultado = audio;\n    }\n\n    return {\n        json: {\n            TEXT: resultado\n        }\n    };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1600,
        -560
      ],
      "id": "036c0213-19c9-4a03-a7e4-accb7625a74a",
      "name": "Code2"
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "589015034296503",
        "recipientPhoneNumber": "={{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}",
        "textBody": "={{ $json.output.response.parte1 }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        4280,
        -560
      ],
      "id": "f0c4ea88-5388-46f2-aa3f-e6eeed0a254b",
      "name": "WhatsApp Business Cloud",
      "webhookId": "2cf89bf3-f0d2-4da3-8e41-1a562cafc462",
      "credentials": {
        "whatsAppApi": {
          "id": "oqcZcWeo4OBtlCnZ",
          "name": "WhatsApp fran"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "prompt": "Instructions:\n--------------\n{instructions}\n--------------\nCompletion:\n--------------\n{completion}\n--------------\n\nAbove, the Completion did not satisfy the constraints given in the Instructions.\nError:\n--------------\n{error}\n--------------\n\nPlease try again. Please only respond with an answer that satisfies the constraints laid out in the Instructions:"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserAutofixing",
      "typeVersion": 1,
      "position": [
        3980,
        -340
      ],
      "id": "f8ff40b8-6c3f-4a0a-823b-983b83078955",
      "name": "Auto-fixing Output Parser"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"response\": {\n    \"parte1\": \"Parte uno de la respuesta\",\n    \"parte2\": \"Parte dos de la respuesta\",\n    \"parte3\": \"Parte tres de la respuesta (opcional).\"\n  }\n}\n"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        4220,
        -140
      ],
      "id": "22a40b1d-f8c7-4df8-879e-1501423a01b7",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "amount": 4
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        4740,
        -640
      ],
      "id": "71b10832-8035-4b90-9ac6-8e6fa3ec7f64",
      "name": "Wait 2",
      "webhookId": "67c6288f-f9b8-43d5-8be6-39f57cbdbb1a"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6c883ec3-6f23-4834-b4fc-a8f7ff5eacc5",
              "leftValue": "={{ $('Generador de respuestas').item.json.output.response.parte3 }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        5100,
        -440
      ],
      "id": "4b85085b-9c3b-476e-aa4d-238d85389afc",
      "name": "If Parte 3"
    },
    {
      "parameters": {
        "amount": 4
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        5260,
        -560
      ],
      "id": "2da14f67-e7f6-45a4-abe3-b1177001a224",
      "name": "Wait 3",
      "webhookId": "5e4f296c-0ce0-44fa-9799-c2b37bb15f4d"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "806fb232-eb65-4d07-8d56-499f1da263d8",
              "name": "output",
              "value": "={{ $('AI Agent').item.json.output }}\"\n\n\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4540,
        -240
      ],
      "id": "090c3b92-428c-45ec-976f-9726c4233218",
      "name": "on_error"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        5580,
        -460
      ],
      "id": "51e9e4bd-1a10-412e-9cee-9f0ef36d3211",
      "name": "No Operation, do nothing2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.Texto }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=# Adapta la respuesta \"{{ $json.Texto }}\" de acuerdo a las siguientes instrucciones:\n\n- Elimina estos caractÃ©res:\n  â€¢\"*\", \"Â¿\", \"Â¡\", \"#\"\n- MantÃ©n los saltos de lÃ­nea cuando corresponda, principalmente en los listados o Bullet Point Lists.\n- Utiliza signos de interrogaciÃ³n \"?\" solo en el final de las frases.\n- El mensaje debe sonar relajado, formal y respetuoso. \n- Si la respuesta es breve, rellena Ãºnicamente la parte1.\n- Si la respuesta es mÃ¡s extensa, considera rellenar la parte2 y la parte3.\n- Si el mensaje contiene una lista, dÃ©jala sola en una parte, *manteniendo el formato de lista* (con los saltos de lÃ­nea correspondientes).\n- El output debe sonar muy natural y humano. Debes eliminar las siguientes frases o similares:\n  - \"Estoy aquÃ­ para ayudarte\" \n  - \"Gracias por la informaciÃ³n\" \n  - \"No dudes en preguntar\"\n  - \"Con gusto te ayudarÃ©\".\n- La respuesta final debe ser lo mÃ¡s similar posible a la respuesta inicial, no cambies radicalmente las palabras o el significado de la respuesta inicial si no es necesario.\n\n"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        3820,
        -560
      ],
      "id": "60c4908f-9243-4bef-9fc6-3aab07ada609",
      "name": "Generador de respuestas",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c722cfec-cc19-43f0-804f-5ce50bacff2b",
              "leftValue": "={{ $('Generador de respuestas').item.json.output.response.parte2 }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4540,
        -560
      ],
      "id": "72240561-7eb6-45d5-95f9-4c415e8cdde9",
      "name": "If5"
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "589015034296503",
        "recipientPhoneNumber": "={{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}",
        "textBody": "={{ $('Generador de respuestas').item.json.output.response.parte2 }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        4900,
        -640
      ],
      "id": "413c9160-ca44-4568-874c-8be82a3a9ae3",
      "name": "WhatsApp Business Cloud2",
      "webhookId": "75265aa3-35b4-48e0-ade2-c64dc0310a9b",
      "credentials": {
        "whatsAppApi": {
          "id": "oqcZcWeo4OBtlCnZ",
          "name": "WhatsApp fran"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "589015034296503",
        "recipientPhoneNumber": "={{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}",
        "textBody": "={{ $('Generador de respuestas').item.json.output.response.parte3 }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        5420,
        -560
      ],
      "id": "8bfb465d-379f-47c0-a840-66099aae34a0",
      "name": "WhatsApp Business Cloud3",
      "webhookId": "82a6600c-bf3a-46b9-9bc7-4c34994faf95",
      "credentials": {
        "whatsAppApi": {
          "id": "oqcZcWeo4OBtlCnZ",
          "name": "WhatsApp fran"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        3820,
        -220
      ],
      "id": "d6d2bc03-395b-4ac0-bb99-c6e868212537",
      "name": "OpenAI Chat Model4",
      "credentials": {
        "openAiApi": {
          "id": "ncEn8Lip4F0P7Ul7",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8e6777c4-44ed-46ac-a73d-7a68a21c2dc6",
              "name": "Texto",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3240,
        -560
      ],
      "id": "1982fd3b-2f27-4281-a4c4-d8502e5aa392",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Edit Fields').item.json['ID ConversaciÃ³n'] }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        2640,
        -1100
      ],
      "id": "964efa0d-4218-4f32-a013-c565bdc7f0c9",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Edit Fields').item.json['ID ConversaciÃ³n'] }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        2640,
        -720
      ],
      "id": "15d25dd6-b2c7-46d0-8ab7-e9134fb1c0f6",
      "name": "Simple Memory1"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Edit Fields').item.json['ID ConversaciÃ³n'] }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        2640,
        -340
      ],
      "id": "911078f2-cc0d-4097-a7fe-00d91ca24081",
      "name": "Simple Memory2"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Edit Fields').item.json['ID ConversaciÃ³n'] }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        2640,
        40
      ],
      "id": "6785398c-ec66-4312-859c-0fe6b5c4122c",
      "name": "Simple Memory3"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2480,
        460
      ],
      "id": "0c485411-9eaf-4caa-b2f1-0177bac5a898",
      "name": "OpenAI Chat Model5",
      "credentials": {
        "openAiApi": {
          "id": "ncEn8Lip4F0P7Ul7",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Edit Fields').item.json['ID ConversaciÃ³n'] }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        2640,
        460
      ],
      "id": "b997318d-08f1-433f-8a65-3a1a1121cb83",
      "name": "Simple Memory4"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=AquÃ­ tienes el mensaje que te ha enviado el cliente: {{ $('Set \\'Text\\'').item.json.text }}",
        "options": {
          "systemMessage": "=Eres MÃ³nica, una IA conversacional experta en seguimiento y nutriciÃ³n de leads dentro de IA Winners Academy.\nTu misiÃ³n es hablar con personas que ya han tenido una primera reuniÃ³n con el equipo, estÃ¡n interesadas en entrar a la Academia, pero aÃºn no han tomado la decisiÃ³n.\n\nTu enfoque es profesional, empÃ¡tico y muy humano.\nNo envÃ­as el enlace de agenda directamente.\nTu trabajo es analizar a fondo sus miedos, dudas y motivaciones (extraÃ­dos de la reuniÃ³n), nutrir la conversaciÃ³n, hacer buenas preguntas y detectar el momento exacto para invitar a reagendar.\n\nSolo envÃ­as el enlace cuando:\n\nEl lead expresa interÃ©s claro en avanzar.\n\nO responde afirmativamente a reagendar.\n\nðŸ“¥ Datos del lead\nNombre: {{ $('Switch2').item.json.NombreLead }}\n\nNotas (resumen completo de la reuniÃ³n): {{ $json.notes[0].body }}\n\nEnlace para reagendar (enviar solo si el lead lo pide o lo acepta):\nðŸ‘‰ https://iawinners.com/agenda-reunion-ia\n\nya_reagendado: true/false\n\nðŸ§© Estilo Conversacional\nHablas como una persona real.\n\nTono cercano, de confianza. Como alguien que entiende al 100% lo que estÃ¡ en juego para el lead.\n\nEscribes en mensajes cortos, tipo WhatsApp (1â€“2 lÃ­neas por bloque).\n\nNunca presionas, pero sabes guiar con claridad y seguridad.\n\nAnalizas Notas como una psicÃ³loga de ventas:\nIdentificas sus miedos, sus deseos, lo que lo frenaâ€¦ y lo trabajas poco a poco en conversaciÃ³n.\n\nðŸ§  Â¿CÃ³mo usar la variable Notas?\nDetecta lo que quiere lograr â†’ motÃ­vale y conÃ©ctalo con el beneficio de avanzar.\n\nDetecta lo que le da miedo o le frena â†’ tranquilÃ­zalo con empatÃ­a real + posibles soluciones.\n\nDetecta su momento actual de vida / trabajo / mentalidad â†’ ayÃºdale a ver que este puede ser el momento.\n\nðŸ’¬ Ejemplo de ConversaciÃ³n Inteligente\nEscenario:\nNombre: Marta\n\nNotas: â€œLe gustarÃ­a empezar una agencia pero tiene miedo de no tener conocimientos tÃ©cnicos ni tiempo por su trabajo actual.â€\n\nPrimer mensaje:\nEy Marta! ðŸ‘‹\nSoy MÃ³nica, del equipo IA Winners.\nEstuve leyendo lo que hablaste en la reuniÃ³n y me he quedado pensando en lo que dijiste sobre el tema del tiempo y la parte tÃ©cnicaâ€¦\n\nSegundo mensaje (nutriendo):\nÂ¿TÃº cÃ³mo lo ves ahora? Â¿Sientes que ese bloqueo sigue igual?\nPorque muchas veces pensamos que necesitamos tener todo bajo controlâ€¦ y en realidad se puede empezar mÃ¡s simple de lo que parece.\n\nTercer mensaje (invitando a la reflexiÃ³n):\nY si la idea de la agencia te sigue rondando la cabeza, Â¿quÃ© crees que te ayudarÃ­a a sentirte segura para dar el siguiente paso?\n\nSi el lead responde con apertura, interÃ©s o duda especÃ­fica:\nTiene sentido lo que dices.\nJustamente por eso creemos que una segunda llamada puede ayudarte a ver mÃ¡s claro si es para ti o no â€” sin presiones.\n\nÂ¿Te gustarÃ­a reagendar para verlo con el equipo?\n\nSi responde â€œsÃ­â€ o acepta reagendar:\nÂ¡Perfecto! Te dejo el enlace para que reserves cuando te venga bien:\nðŸ‘‰ https://iawinners.com/agenda-reunion-ia ðŸ“²\n\nEsta vez ve con todas tus dudas, que estÃ¡n ahÃ­ para ayudarte 1 a 1.\n\nðŸš« Reglas clave\nNo envÃ­as el enlace al inicio.\n\nSolo lo envÃ­as si el lead dice que sÃ­, muestra interÃ©s directo o responde con apertura.\n\nNo agendas tÃº, ni propones dÃ­as/horas.\n\nNo hablas de la academia como curso, ni mencionas formaciÃ³n.\n\nTu trabajo es: conversar, nutrir, escuchar, detectar, guiar.\n\nðŸ“ Notas Finales\nSÃ© cÃ¡lida, directa y muy buena escuchando.\n\nUsa Notas como una brÃºjula emocional para saber quÃ© tocar.\n\nSolo 1â€“2 emojis por mensaje. Flow natural.\n\nTu rol es esencial: sin esta conversaciÃ³n, el lead se enfrÃ­a.\nTu misiÃ³n es volver a encender esa llama â€” y llevarlo a reagendar.\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        2540,
        240
      ],
      "id": "57e56d53-6e31-4da9-8e2f-15a4d3bf14f1",
      "name": "Agente Seguimiento (Reagendar)"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "recibo-mensaje-chatwoot",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -780,
        -560
      ],
      "id": "9a23e5a0-b2f4-4480-a50e-cfd7fe62b765",
      "name": "Webhook",
      "webhookId": "a2d9a899-8af4-448f-8a73-da2af400346d"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        800,
        -740
      ],
      "id": "80f6e889-31eb-4e70-a665-0cd8e57f83f0",
      "name": "a espera de solucionar formato de audio"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        800,
        -360
      ],
      "id": "762c32cf-28f6-4947-892d-3491dd19c953",
      "name": "a espera de solucionar formato de imagen"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Respuesta a formatear:\n{{ $json.output }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=# Tarea  \nTu funciÃ³n principal consiste en crear un JSON que contenga las diferentes partes importantes  del mensaje que vayas a recibir   \nNotas :  \n. debes seguir la siguiente estructura de JSON:  \n{\n  \"response\": {\n    \"part_1\": \"Responde con la primera parte de la respuesta.\",\n    \"part_2\": \"Responde con la segunda parte de la respuesta.\",\n    \"part_3\": \"Responde con la tercera parte de la respuesta (opcional).\",\n    \"part_4\": \"Responde con la cuarta parte de la respuesta (opcional).\",\n    \"part_5\": \"Responde con la quinta parte de la respuesta (opcional).\"\n  }\n}\n .  debes dividir los mensajes de una manera que suene bien,  me explico debes analizar que tan largo es el mensaje que recibes y en base en eso dividir el mensaje en las partes que sean necesarias, por ejemplo si el mensaje es breve divÃ­delo en 1 o 2 partes y si el mensaje es extenso divÃ­delo en 3 o 4 partes   \n. las partes que dividas deben tener sentido, no dividas las partes por hacerlo, piensa 2 veces antes de hacerlo\n. "
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        3380,
        460
      ],
      "id": "53e59633-7842-4381-a1f0-c410411c3d24",
      "name": "Format Chain",
      "retryOnFail": true,
      "maxTries": 5,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8d46d583-b82d-4d85-a0b8-2c30006082a0",
              "leftValue": "={{ $('Format Chain').item.json.output.response.part_2 }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4080,
        220
      ],
      "id": "0cf03b99-b3f0-46e8-91cf-a764c159da3b",
      "name": "If"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        4300,
        180
      ],
      "id": "8eb7b7ad-20e3-4ab5-a842-2ad77a294b30",
      "name": "Wait",
      "webhookId": "a87f8c54-00cf-456e-99fd-dfa7116e48e2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3c7eb0e9-13ee-40d6-9738-057a02ac1306",
              "leftValue": "={{ $('Format Chain').item.json.output.response.part_3 }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4300,
        420
      ],
      "id": "c88dff26-f6a2-4d65-b5f6-35d4e11737bb",
      "name": "If1"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        4600,
        200
      ],
      "id": "3b2f2873-a9b0-4cd8-86d0-030b6104c580",
      "name": "Wait1",
      "webhookId": "09b958ad-8fa5-4fdf-9247-9d90fba41415"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "10bc21c7-e460-458f-b0cb-d9e37e9bde8a",
              "leftValue": "={{ $('Format Chain').item.json.output.response.part_4 }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4600,
        440
      ],
      "id": "8898921e-ef04-42ce-8e3a-52492c46a597",
      "name": "If2"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        4820,
        380
      ],
      "id": "f906244f-73a5-442b-8f99-07e7aef1ff97",
      "name": "Wait2",
      "webhookId": "e1418732-af66-4f40-ae81-976575c83712"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3c7eb0e9-13ee-40d6-9738-057a02ac1306",
              "leftValue": "= {{ $('Format Chain').item.json.output.response.part_5 }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4780,
        640
      ],
      "id": "7dd567e9-bf8e-461f-af4d-e515754e9dfd",
      "name": "If3"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        5000,
        640
      ],
      "id": "39fc8c76-7a81-4bc2-8961-38cac8eebc8f",
      "name": "Wait3",
      "webhookId": "a7002056-0888-4b79-a9e5-efebc6ad35c1"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "=A continuaciÃ³n te vamos a mostrar el Ãºltimo mensaje de una conversaciÃ³n donde un usuario estÃ¡ interactuando con un asistente sobre propiedades inmobiliarias (no tendrÃ¡s la conversaciÃ³n completa).\n\nDebes identificar si el mensaje indica que el cliente quiere hablar con Javi Manzano, ya sea pidiÃ©ndolo de forma directa (por ejemplo: \"quiero hablar con Javi Manzano\") o indirecta (por ejemplo: \"quiero hablar con Javi\", \"quiero que me contacte Javi\", \"prefiero tratar esto con una persona\").\n\nSi el mensaje indica que el cliente quiere hablar con un agente, debes responder: \"true\"\nEjemplo: true\n\nSi el mensaje no indica que el cliente quiere hablar con un agente, debes responder: \"false\"\nEjemplo: false",
              "role": "system"
            },
            {
              "content": "=Este es el mensaje:\n{{ $('AI Agent').item.json.output }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        6620,
        380
      ],
      "id": "128f563f-d7da-4d95-a189-452e747f757e",
      "name": "Identificar conversacion terminada",
      "credentials": {
        "openAiApi": {
          "id": "ncEn8Lip4F0P7Ul7",
          "name": "OpenAi account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Â¿Avisos por algÃºn evento?",
        "height": 400,
        "width": 1140
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        6540,
        220
      ],
      "typeVersion": 1,
      "id": "83115163-d369-4db1-8ca6-469ad3f73612",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3c963008-c7ec-46bd-912e-d83f151f1469",
              "leftValue": "={{ $json.message.content }}",
              "rightValue": "True",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        6980,
        380
      ],
      "id": "bb96c3ad-6f2d-4dc6-ab8a-9fba9fabbf42",
      "name": "If10"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://chatwoot-production-ab57.up.railway.app/api/v1/accounts/1/contacts/{{ $('Webhook1').item.json.body.conversation.contact_inbox.contact_id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "api_access_token",
              "value": "(tu api key)"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"custom_attributes\": {\n    \"bot\": \"off\"\n  }\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        7420,
        360
      ],
      "id": "ee8698da-e255-4092-a8df-993ea67fbeee",
      "name": "Apagar Bot"
    },
    {
      "parameters": {
        "sendTo": "=javimanzano180@gmail.com",
        "subject": "=Â¡{{ $('WhatsApp Trigger1').item.json.contacts[0].profile.name }} necesita tu ayuda!",
        "message": "=ALERTA DE INTERVENCIÃ“N ðŸ””<br><br>\nTienes que intervenir en la conversaciÃ³n del cliente: {{ $('WhatsApp Trigger1').item.json.contacts[0].profile.name }}<br>\ny su nÃºmero de telÃ©fono es {{ $('WhatsApp Trigger1').item.json.contacts[0].wa_id }}<br><br>\n\nÂ¡El cliente quiere hablar con Javi Manzano! ðŸ \n",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        7220,
        360
      ],
      "id": "5d1b59f7-d191-4fa7-bceb-d637b068c92e",
      "name": "Gmail1",
      "webhookId": "812600ae-1df3-4266-92a0-046d4aae3824",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserAutofixing",
      "typeVersion": 1,
      "position": [
        3440,
        620
      ],
      "id": "fde42805-3f0d-4e84-a90b-b2416305a20b",
      "name": "Auto-fixing Output Parser1"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"response\": {\n    \"part_1\": \"Responde con la primera parte de la respuesta.\",\n    \"part_2\": \"Responde con la segunda parte de la respuesta.\",\n    \"part_3\": \"Responde con la tercera parte de la respuesta (opcional).\",\n    \"part_4\": \"Responde con la cuarta parte de la respuesta (opcional).\",\n    \"part_5\": \"Responde con la quinta parte de la respuesta (opcional).\"\n  }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        3600,
        740
      ],
      "id": "468b536f-5f45-4cbe-8a18-4758fd600f1c",
      "name": "Structured Output Parser1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        3280,
        620
      ],
      "id": "26bcba74-9485-4778-849d-e00bbbbcab8a",
      "name": "OpenAI Chat Model6",
      "disabled": true
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        3420,
        740
      ],
      "id": "292d657c-3339-4127-bdd2-2988acc8a9fa",
      "name": "OpenAI Chat Model7",
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://chatwoot-production-ab57.up.railway.app/api/v1/accounts/1/conversations/{{ $('Webhook1').item.json.body.conversation.messages[0].conversation_id }}/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "api_access_token",
              "value": "(tu api key)"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"content\": \"{{ JSON.stringify($('Format Chain').item.json.output.response.part_1).slice(1, -1) }}\",\n  \"message_type\": \"outgoing\",\n  \"private\": \"false\"\n} ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3880,
        220
      ],
      "id": "7cb4c111-e98d-4114-afaa-107a23dac0b5",
      "name": "HTTP Request8"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://chatwoot-production-ab57.up.railway.app/api/v1/accounts/1/conversations/{{ $('Webhook1').item.json.body.conversation.messages[0].conversation_id }}\n/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "api_access_token",
              "value": "(tu api key)"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"content\": \"{{ $json.output }}\",\n  \"message_type\": \"outgoing\",\n  \"private\": false\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3860,
        600
      ],
      "id": "72ae4cf5-6b29-485d-a610-fabd486d3cb2",
      "name": "HTTP Request9"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-04-16T09:35:44.667Z",
      "updatedAt": "2025-04-16T09:35:44.667Z",
      "id": "HplrFFowHMbKC6tm",
      "name": "MÃ³nica Setting"
    },
    {
      "createdAt": "2025-04-16T10:35:06.049Z",
      "updatedAt": "2025-06-07T15:07:46.386Z",
      "id": "VhIhN54OJ1lWSvmg",
      "name": "ðŸŸ© Evergreen"
    }
  ],
  "triggerCount": 2,
  "updatedAt": "2025-04-17T14:10:07.000Z",
  "versionId": "559eaa30-a65a-4694-a40b-f70b71c2d25e"
}